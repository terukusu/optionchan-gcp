# Cloud Pub/Sub
gcloud pubsub topics create minutely_task

# Cloud Storage
gsutil mb -l us-east1 -c regional gs://jikken/

# BigQuery
bq mk --data_location=us jikken

bq mk --time_partitioning_field=created_at --clustering_fields=last_trading_day --schema=./schema/option_price.json jikken.option_price

bq mk --time_partitioning_field=created_at --clustering_fields=contract_month --schema=./schema/future_price.json jikken.future_price

bq mk --time_partitioning_field=created_at --schema=./schema/spot_price.json=jikken.spot_price

# Cloud Functions
gcloud beta functions deploy download_jpx --runtime=python37 --region=us-east1 --trigger-topic minutely_task

gcloud beta functions deploy load_jpx_into_bq --runtime=python37 --region=us-east1 --trigger-resource jikken --trigger-event google.storage.object.finalize

gcloud beta functions deploy smile_data --runtime=python37 --region=us-east1 --trigger-http

gcloud beta functions deploy atm_data --runtime=python37 --region=us-east1 --trigger-http

# Cloud Scheduler
gcloud beta scheduler jobs create pubsub minutely_task --time-zone=Asia/Tokyo --schedule="* * * * *" --topic=minutely_task --message-body=minutely_task

# App Engine
gcloud app deploy
