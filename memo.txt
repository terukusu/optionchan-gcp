BQ容量
197MB/7w-day

推定年間使用容量
244day / 7day * 197MB = 6.7GB


# Cloud Pub/Sub
gcloud pubsub topics create minutely_task

gcloud pubsub topics create minutely15_task

# Cloud Storage
gsutil mb -l us-east1 -c regional gs://optionchan/

# BigQuery
bq mk --data_location=us optionchan

bq mk --time_partitioning_field=created_at --clustering_fields=last_trading_day --schema=./schema/option_price.json optionchan.option_price

bq mk --time_partitioning_field=created_at --clustering_fields=contract_month --schema=./schema/future_price.json optionchan.future_price

bq mk --time_partitioning_field=created_at --schema=./schema/spot_price.json optionchan.spot_price

# Cloud Functions
gcloud functions deploy download_jpx --runtime=python37 --region=us-east1 --trigger-topic minutely_task

gcloud functions deploy load_jpx_into_bq --runtime=python37 --region=us-east1 --trigger-resource optionchan --memory=128 --trigger-event google.storage.object.finalize

gcloud functions deploy smile_data --runtime=python37 --region=us-east1 --trigger-http

gcloud functions deploy atm_data --runtime=python37 --region=us-east1 --trigger-http

# Cloud Scheduler
gcloud beta scheduler jobs create pubsub minutely_task --time-zone=Asia/Tokyo --schedule="* * * * *" --topic=minutely_task --message-body=minutely_task

gcloud beta scheduler jobs create pubsub minutely_task --time-zone=Asia/Tokyo --schedule="*/15 * * * *" --topic=15minutely_task --message-body=15minutely_task

# App Engine
gcloud app deploy

# auth
共通パスワードを書き込んだ auth.txt ファイルを
appengine と functions フォルダに用意する。
